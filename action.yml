name: 'venv setup'
description: 'configures venv, python and caches'
python-version:
  description: "Version range or exact version of Python or PyPy to use, using SemVer's version range syntax."
  required: true
runs:
  using: 'composite'
  steps:
    - name: Setup python
      uses: actions/setup-python@13ae5bb136fac2878aff31522b9efb785519f984  # v4.3.0
      with:
        python-version: ${{ inputs.python-version }}

    - name: Make venv

    - name: Pip install

    - name: setup-volta vars
      id: vars
      shell: bash
      run: python3 -uS ${{ github.action_path }}/bin/setup-volta vars

    - name: cache volta+node+yarn
      id: cache
      uses: actions/cache@58c146cc91c5b9e778e71775dfe9bf1442ad9a12  # v3.2.3
      with:
        path: ${{ steps.vars.outputs.volta-dir }}
        key: ${{ steps.vars.outputs.cache-key }}

    - name: install volta+node+yarn
      if: steps.cache.outputs.cache-hit != 'true'
      shell: bash
      run: python3 -uS ${{ github.action_path }}/bin/setup-volta install

    - name: yarn cache dir
      id: yarn
      shell: bash
      run: python3 -uS ${{ github.action_path }}/bin/setup-volta yarn-cache-dir

    - name: cache yarn
      uses: actions/cache@58c146cc91c5b9e778e71775dfe9bf1442ad9a12  # v3.2.3
      with:
        path: ${{ steps.yarn.outputs.cache-dir }}
        key: ${{ steps.vars.outputs.cache-key }}-${{ hashFiles('**/yarn.lock') }}
