#!/usr/bin/env python3
import argparse
import hashlib
import io
import os.path
import secrets
import subprocess
import sys
import tarfile
import urllib.request
from typing import List

PYTHON_VERSION="3.8.13"
VENV_DIR=os.path.abspath(".venv")
VENV_BIN_DIR=os.path.join(VENV_DIR, "bin")

def req_files_key():
	return "TODO"

def main() -> int:
    parser = argparse.ArgumentParser()
    parser.add_argument("--requirement-files", nargs='+')
    parser.add_argument("--constraint-files", nargs='*')
    args = parser.parse_args()

    print(f"args: {args.required_files} ${args.constraint_files}")

    cache_key = f"{sys.platform}-py-{PYTHON_VERSION}-{req_files_key()}"

    with open(os.environ["GITHUB_OUTPUT"], "a+") as f:
        print(f"cache-key={cache_key}", file=f)
        print(f"venv-dir={VENV_DIR}", file=f)

    print(f"adding {VENV_BIN_DIR} to path")
    with open(os.environ["GITHUB_PATH"], "a+") as f:
        f.write(f"{VENV_BIN_DIR}\n")

    print(f"adding VIRTUAL_ENV={VENV_DIR} to env")
    with open(os.environ["GITHUB_ENV"], "a+") as f:
        f.write(f"VIRTUAL_ENV={VENV_DIR}\n")


if __name__ == "__main__":
    raise SystemExit(main())
